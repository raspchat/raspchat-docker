Function.prototype.bind||(Function.prototype.bind=function(e){var n=this;return function(){var t=Array.prototype.slice.call(arguments);return n.apply(e,t)}}),window.$glueFunctions=function(e){for(var n in e)e[n]instanceof Function&&(e[n]=e[n].bind(e))},window.$mix=function(){var e={};if(Object.assign){var n=Array.prototype.slice.call(arguments);return Object.assign.apply(Object,n)}for(var t=0;t<arguments.length;t++)for(var o in arguments[t])arguments[t].hasOwnProperty(o)&&(e[o]=arguments[t][o]);return e},window.core=function(e,n,t){var o="SERVER",i=/^\/(nick|gif|join|leave|list|switch)\s*(.*)$/i,s={list:{eventName:"list-group",paramRequired:!1,defaultParam:!1},nick:{eventName:"set-nick",paramRequired:!0},"switch":{eventName:"switch-group",paramRequired:!0},join:{eventName:"join-group",paramRequired:!0},leave:{eventName:"leave-group",paramRequired:!1,defaultParam:!1},gif:{eventName:"send-gif",paramRequired:!0}},r=function(e,n){var t=e.match(i);if(!t||!s[t[1]])return!1;if("help"==t[1].toLowerCase())return!0;var o=s[t[1]],r=t[2];return!(o.paramRequired&&!r)&&(r=r||o.defaultParam,n(o.eventName,r),!0)},a=function(){var n=e.location,o=n.protocol.toLowerCase().endsWith("s:"),i=t&&t.webSocketConnectionUri,s=t&&t.webSocketSecureConnectionUri,r=(o?s:i)||"{protocol}//{host}/chat",a=""+r,c={host:"{host}",port:"{port}",hostname:"{hostname}",pathname:"{path}"};for(var h in c){var u=c[h];a.indexOf(u)>-1&&(a=a.replace(u,""+n[h]))}return a=a.replace("{protocol}",o?"wss:":"ws:")},c=function(){this._channels={}};c.prototype={fire:function(n){for(var t=this._channels[n]||[],o=t.length,i=Array.prototype.slice.call(arguments,1),s=0;s<o;s++)!function(n){var o=t[n];e.setTimeout(function(){o&&o.apply(this,i||[])},0)}(s)},off:function(e,n){for(var t=this._channels[e]||[],o=t.length;o--;)t[o]===n&&t.splice(o,1)},on:function(e,n){this._channels[e]=this._channels[e]||[],this._channels[e].push(n)}};var h=function(e){$glueFunctions(this),this.events=new c,this.sock=null,this.handshakeCompleted=!1,this.url=e||a()};h.prototype={connect:function(e){this.nick=e,this._create_ws_connection()},setNick:function(e){this.send(o,"/nick "+e)},sendRaw:function(e,n){this.sock.send(JSON.stringify({"@":"send-raw-msg",to:e,msg:n}))},isValidCmd:function(e){var n=e.match(i);return!!n},getHistory:function(e,n,t){n=n||0,t=t||50;var o=this,i=encodeURIComponent(e);atomic.setContentType("application/json"),atomic.get("/chat/api/channel/"+i+"/message?limit="+t+"&offset="+n).success(function(n,t){o._on_group_history_recvd(e,n)}).error(function(e,n){events.fire("history-error",n)})},send:function(e,n){var t=this,o=r(n,function(o,i){return"switch-group"==o?void t.events.fire("switch",i):"send-gif"==o?void d.search(i,function(o,s){var r=n;o&&(r="> !["+i+"]("+o+")\n\n> **GIF** "+i+"\n"),t.sock.send(JSON.stringify({"@":"send-msg",to:e,msg:r}))}):("leave-group"!=o&&"list-group"!=o||(i=i||e),void t.sock.send(JSON.stringify({"@":o,to:e,msg:i})))});o||this.sock.send(JSON.stringify({"@":"send-msg",to:e,msg:n}))},_create_ws_connection:function(){try{this.sock&&this.sock.close&&(this.sock.onclose=null,this.sock.onopen=null,this.sock.onmessage=null,this.sock.close())}catch(e){console&&console.error(e)}this.sock=new WebSocket(this.url),this.sock.onopen=this._on_connect,this.sock.onclose=this._on_disconnect,this.sock.onmessage=this._on_data,this.events.fire("connecting")},_on_connect:function(e){this.events.fire("connected")},_on_disconnect:function(){this.handshakeCompleted=!1,this.events.fire("disconnected");var n=this;e.setTimeout(function(){n._create_ws_connection()},1e3)},_on_data:function(e){var n={};try{n=JSON.parse(e.data)}catch(t){console&&console.error("Error decoding",e.data,t)}n["@"]&&this._handleMessage(n)},_completeHandShake:function(e){this.handshakeCompleted||(this.handshakeCompleted=!0,this.setNick(this.nick),this.events.fire("handshake",o),this.events.fire("message",{from:o,to:o,msg:"```"+e.msg+"```"}))},_handleMessage:function(e){switch(e["@"]){case o:this._completeHandShake(e);break;case"group-join":this._on_group_joined(e);break;case"group-leave":this._on_group_left(e);break;case"group-message":this._on_message(e);break;case"nick-set":this._on_nick_changed(e);break;case"member-nick-set":this._on_member_nick_changed(e.to,e.pack_msg);break;case"group-list":this._on_group_members_list(e.to,e.pack_msg);break;case"new-raw-msg":this._on_rawmessage(e.to,e.pack_msg);break;case"ping":this.sock.send(JSON.stringify({"@":"pong",t:e.t}))}},_on_rawmessage:function(e,n){this.events.fire("raw-message",e,n)},_on_message:function(e){e.delivery_time=e.delivery_time||new Date,this.events.fire("message",e)},_on_group_joined:function(e){var n=this.events;n.fire("message",{from:o,to:o,delivery_time:new Date,msg:e.from+" joined "+e.to}),n.fire("joined",e),this.getHistory(e.to)},_on_group_history_recvd:function(e,n){var t=n.messages.map(this._prepareMetaMessage).reverse();this.events.fire("history",$mix(n,{messages:t}))},_prepareMetaMessage:function(e){var n=$mix(e);switch(e["@"]){case"group-join":n.meta={action:"joined"};break;case"group-leave":n.meta={action:"leave"};break;default:n.meta=null}return n},_on_group_members_list:function(e,n){this.events.fire("members-list",e,n)},_on_group_left:function(e){this.events.fire("message",{from:o,to:o,delivery_time:new Date,msg:e.from+" left "+e.to}),this.events.fire("leave",e)},_on_nick_changed:function(e){this.nick=e.newNick,this.events.fire("nick-changed",e.newNick,e.oldNick)},_on_member_nick_changed:function(e,n){this.events.fire("message",{to:e,msg:n.oldNick+" changed nick to "+n.newNick,from:n.newNick,delivery_time:new Date})}},h.HelpMessage="Valid commands are: \n/help for this help :)\n/list for list of members in a group\n/gif <gif-keywords> to send a gif \n/join <group_name> to join a group (case-sensitive)\n/nick <new_name> for changing your nick (case-sensitive)\n/switch <group_name> to switch to a joined group (case-sensitive)\n";var u={},d={search:function(e,n){e=encodeURIComponent(e),atomic.setContentType("application/json"),atomic.get("/gif?q="+e).success(function(e,t){n(e.url,e)}).error(function(e,t){n(null,null)})}};return{Transport:h,EventEmitter:c,GetTransport:function(e,n){return u[e]=u[e]||new h(n),u[e]}}}(window,window.document,window.RaspConfig),core.p2p=function(e){var n=(!!e.mozRTCPeerConnection,e.RTCPeerConnection||e.mozRTCPeerConnection||e.webkitRTCPeerConnection),t=e.RTCSessionDescription||e.mozRTCSessionDescription||e.webkitRTCSessionDescription,o=e.RTCIceCandidate||e.mozRTCIceCandidate||e.webkitRTCIceCandidate,i=function(e){$glueFunctions(this),this.options=e||{channel:"WebRTCPeer",reliable:!0};var t={iceServers:[{urls:"stun:23.21.150.121"},{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"Hello123",username:" stun-register@yopmail.com"}]},o=null;this.events=new core.EventEmitter,this.peerConnection=new n(t,o),this.offers=[],this.iceCandidates=[],this.peerConnection.onicecandidate=this.onICECandidate,this.peerConnection.ondatachannel=this.onRecvDataChannel};return i.prototype={close:function(){this.channel&&(this.channel.close(),this.channel=null),this.peerConnection&&(this.peerConnection.close(),this.offers=[],this.icecandidates=[],this.peerConnection=null)},onICECandidate:function(e){e.candidate&&(this.iceCandidates.push(e.candidate),this.events.fire("candidate",e.candidate))},addICECandidates:function(e){for(var n=0;n<e.length;n++)console.log("Adding candidate",e[n]),this.peerConnection.addIceCandidate(new o(e[n]))},createOffer:function(n){var t=this;t.peerConnection.createOffer(function(o){t.peerConnection.setLocalDescription(o),t.offers.push(o),e.setTimeout(function(){n&&n(o)},0),t.events.fire("offer",o),t.events.fire("offer.sdp",o.sdp)},function(e){t.events.fire("offer.error",e)})},answerOffer:function(n,o){var i=new t(n),s=this;s.peerConnection.setRemoteDescription(i),s.peerConnection.createAnswer(function(n){s.peerConnection.setLocalDescription(n),e.setTimeout(function(){o&&o(n)},0),s.events.fire("answer",n),s.events.fire("answer.sdp",n.sdp)},function(e){s.events.fire("answer.error",e)})},acceptAnswer:function(e){var n=new t(e),o=this;o.peerConnection.setRemoteDescription(n)},createDataChannel:function(){this.channel=this.peerConnection.createDataChannel(this.options.channel||"WebRTCPeer",{reliable:this.options.reliable||!1}),this.hookDataChannelEvents()},onRecvDataChannel:function(e){this.channel=e.channel,this.hookDataChannelEvents()},hookDataChannelEvents:function(){var e=this,n=function(n){return function(t){e.events.fire(n,t)}};this.channel.onerror=n("error"),this.channel.onmessage=n("message"),this.channel.onopen=n("open"),this.channel.onclose=n("close")}},{Peer2PeerDataConnection:i}}(window),window.core.PeerConnectionNegotiator=function(e){var n=function(e){e.events.on("offer",function(e){console.log("OFFER",e)}),e.events.on("candidate",function(e){console.log("CANDIDATE",e)}),e.events.on("open",function(){console.log("OPENED",e.channel)}),e.events.on("close",function(){console.log("CLOSED",e.channel)}),e.events.on("message",function(e){console.log("MESSAGE",e)})},t=function(e,t){$glueFunctions(this),this.events=new core.EventEmitter,this.dataBuffer=[],this.channel=null,this.peerConnection=new core.p2p.Peer2PeerDataConnection(t),this.peerConnection.events.on("open",this.onPCOpen),this.peerConnection.events.on("close",this.onPCClose),this.peerConnection.events.on("error",this.onPCError),this.peerConnection.events.on("data",this.onPCData),this.transport=e,this.transport.events.on("raw-message",this.onOfferRecv),this.transport.events.on("raw-message",this.onAnswerRecv),n(this.peerConnection)};return t.prototype={close:function(){this.transport.events.off("raw-message",this.onOfferRecv),this.transport.events.off("raw-message",this.onAnswerRecv),this.peerConnection.close(),this.channel=null,this.peerConnection=null,this.transport=null},onPCOpen:function(){for(var e=0;e<this.dataBuffer.length;e++)this.channel.send(this.dataBuffer[e]);this.channel=this.peerConnection.channel,this.events.fire("ready",this.peerConnection.channel)},onPCClose:function(){var e=this.channel;this.channel=null,this.events.fire("close",e)},onPCError:function(e){this.events.fire("error",e)},onPCData:function(e){this.events.fire("data",e.data,e)},send:function(e){return this.channel?void this.channel.send(e):void this.dataBuffer.push(e)},onOfferRecv:function(n,t){if("P2PHandShake"==t.type&&"RequestOffer"==t.mode){console.log("RequestOffer",t);var o=this;o.peerConnection.answerOffer(t.offer,function(i){t.candidates&&(o.peerConnection.addICECandidates(t.candidates),e.setTimeout(function(){o.transport.sendRaw(n,{type:"P2PHandShake",mode:"OfferResponse",offer:i,candidates:o.peerConnection.iceCandidates}),console.log("OfferedResponse",t)},3e3))})}},onAnswerRecv:function(e,n){"P2PHandShake"==n.type&&"OfferResponse"==n.mode&&(console.log("OfferResponse",n),this.peerConnection.acceptAnswer(n.offer),n.candidates&&this.peerConnection.addICECandidates(n.candidates))},connectTo:function(n){var t=this;t.peerConnection.createDataChannel(),t.peerConnection.createOffer(function(o){e.setTimeout(function(){t.transport.sendRaw(n,{type:"P2PHandShake",mode:"RequestOffer",offer:o,candidates:t.peerConnection.iceCandidates})},2e3)})}},t}(window),function(e,n){}(window,Vue),function(e,n,t){e.component("app-bar",e.extend({template:"#app-bar",props:["userId"],data:function(){return{}},ready:function(){},methods:{}}))}(Vue,window,window.document),function(e,n,t){e.component("chat-compose",e.extend({template:"#chat-compose",data:function(){return{message:""}},methods:{enterPressed:function(e){var n=this.message;return e.shiftKey?void this.$set("message",n+"\n"):(this.$set("message",""),this.$dispatch("send-message",n),void this.$el.querySelector(".msg").focus())},tabPressed:function(){var e=this.$get("message");this.$set("message",e+"  ")}}}))}(Vue,window,window.document),function(e,n,t){e.component("chat-log",e.extend({props:["messages"],template:"#chat-messages",ready:function(){this.$el.addEventListener("click",function(e){e=e||n.event,"A"==e.target.tagName&&(n.open(e.target.href,"_blank"),e.preventDefault(),e.stopPropagation())},!1),this.userScrolled=!1,this.selfScroll=!1,this.cont=this.cont||this.$el.querySelector(".chat-messages"),this.timer=n.setInterval(this.scrollToBottom,500)},methods:{onScroll:function(e){if(this.selfScroll)return void(this.selfScroll=!1);var n=this.cont;this.userScrolled=n.scrollHeight-n.offsetHeight-n.scrollTop>50},scrollToBottom:function(e){if(!this.userScrolled){var n=this.cont;e&&e.loadedEventImage;n.scrollTop=n.scrollHeight,this.selfScroll=!0}}}}))}(Vue,window,window.document),function(e,n,t){e.component("chat-message",e.extend({props:["message"],template:"#chat-message",ready:function(){this.hookImageLoads(),this.$dispatch("chat-message-added",this.message),this.$watch("message.msg",function(){this.hookImageLoads(),this.$dispatch("chat-message-added",this.message)}.bind(this))},methods:{imageLoaded:function(e){var n=this;n.$dispatch("chat-image-loaded",{loadedEventImage:e})},hookImageLoads:function(){var e=this.$el.parentNode.querySelectorAll("img");for(var n in e){var t=e[n];this._hasClass(t,"avatar")||t.addEventListener&&(t.removeEventListener("load",this.imageLoaded),t.addEventListener("load",this.imageLoaded,!1))}},_hasClass:function(e,n){var t=(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(n);return t>-1}}}))}(Vue,window,window.document),function(e,n,t){e.component("chrome-bar",e.extend({props:["title","userId"],template:"#chrome-bar",data:function(){return{hamburgerActive:!1}},methods:{hamburgerClicked:function(){this.$set("hamburgerActive",!this.hamburgerActive),this.$dispatch("hamburger-clicked",this.hamburgerActive)}}}))}(Vue,window,window.document),function(e,n,t){var o=new markdownit("default",{linkify:!0});e.filter("markdown",function(e){return o.render(e)}),e.filter("better_date",function(e){return moment(e).calendar()}),e.filter("escape_html",function(e){return he.encode(e)}),e.filter("falsy_to_block_display",function(e){return e?"block":"none"});var i=document.createDocumentFragment(),s=document.createElement("div");i.appendChild(s),e.filter("emojify",function(e){return emojify?(s.innerHTML=e,emojify.run(s),s.innerHTML):e}),e.filter("avatar_url",function(e){return"//api.adorable.io/avatars/256/zmg-"+e+".png"})}(Vue,window,window.document),function(e,n,t){e.component("groups-list",e.extend({template:"#groups-list",data:function(){return{groups:[],selected:""}},ready:function(){this.groupsInfo={},this.$on("group_joined",this.groupJoined),this.$on("group_switched",this.groupSwitch),this.$on("group_left",this.groupLeft),this.$on("message_new",this.newMessage)},methods:{selectGroup:function(e){this._setUnread(e,0),this.$set("selected",e),this.$dispatch("switch",e)},leaveGroup:function(e){this.$dispatch("leave",e)},groupSwitch:function(e){this.selectGroup(e)},groupJoined:function(e){var n=this.groupsInfo[e]=this.groupsInfo[e]||{name:e,unread:0,index:this.groups.length};this.groups.push(n)},groupLeft:function(e){var n=this.groupsInfo[e]||{index:-1};n.index!=-1&&this.groups.splice(n.index,1)},newMessage:function(e){return this.selected==e.to||!this.groupsInfo[e.to]||(this._setUnread(e.to,this._getUnread(e.to)+1),!0)},_getUnread:function(e){return this.groupsInfo[e]&&this.groupsInfo[e].unread||0},_setUnread:function(n,t){return e.set(this.groupsInfo[n],"unread",t),!0}}}))}(Vue,window,window.document),function(e,n,t,o){var i=o.externalSignIn||{useProviders:!1},s=/[^a-zA-Z0-9]+/gi;e.component("google-sign-in",{template:'<div id="google-sign-in"></div>',ready:function(){if(i.googleClientId){var n=t.querySelector("head"),o=t.createElement("meta");o.name="google-signin-client_id",o.content=i.googleClientId,n.appendChild(o),e.nextTick(this.loadScript)}},methods:{loadScript:function(){var e="__google_sign_in_"+(new Date).getTime();n[e]=this.scriptLoaded;var o=t.querySelector("head"),i=t.createElement("script");i.type="text/javascript",i.src="//apis.google.com/js/platform.js?onload="+e,o.appendChild(i)},scriptLoaded:function(){gapi.signin2.render("google-sign-in",{scope:"profile email",width:240,height:50,longtitle:!0,theme:"light",onsuccess:this.onSuccess,onfailure:this.onFailure})},onSuccess:function(e){var n=e.getBasicProfile(),t=n.getEmail().split("@")[0],o={id:t,name:n.getName(),host:"google"};this.$dispatch("success",o,e)},onFailure:function(e){this.$dispatch("fail",e)}}}),e.component("login-form",{template:"#login-form",data:function(){return{isReady:!1,isSignedIn:!1,isValidNick:!1,nick:""}},ready:function(){this.$set("isReady",!0),this.$watch("nick",this.onNickChanged),i.useProviders||this.$set("isSignedIn",!0)},methods:{googleSignInSuccess:function(e){localStorage.userInfo=JSON.stringify(e),this.$set("isSignedIn",!0),localStorage.userNick?this.$set("nick",localStorage.userNick):this.$set("nick",e.id)},onNickChanged:function(){this.nick.length>0&&!this.nick.match(s)?this.$set("isValidNick",!0):this.$set("isValidNick",!1)},signin:function(){this.isValidNick&&(localStorage.userNick=this.nick,this.$dispatch("login",this.nick))}}})}(Vue,window,window.document,window.RaspConfig),function(e,n,t){var o={data:function(){return{enabled:!1}},methods:{toggle:function(){var e=this.$get("enabled");this.$set("enabled",!e),this.onEnableChanged&&this.onEnableChanged(e)}}};e.component("toast-notification-button",e.extend({template:"#toast-notification-button",mixins:[o],props:["ignoreFor"],ready:function(){this.$set("enabled","granted"===Notification.permission),this.$on("message_new",this.onNotification)},methods:{onNotification:function(e,n){if(this.$get("enabled")&&!n.noNotification&&e.from!=this.ignoreFor&&!t.hasFocus()){var o=""+e.msg;o.length>64&&(o=o.substring(0,64)+"..."),new Notification(e.from,{body:o,icon:"/static/favicon/favicon.ico"})}},onEnableChanged:function(e){0==e&&"granted"!==Notification.permission&&Notification.requestPermission(this.onPermissionChanged)},onPermissionChanged:function(e){"granted"!==e&&this.$get("enabled")&&this.$set("enabled",!1)}}})),e.component("sound-notification-button",e.extend({template:"#sound-notification-button",mixins:[o],props:["defaultEnabled","ignoreFor"],ready:function(){this.pingSound=new Audio("/static/ping.mp3"),this.playingSound=!1,this.defaultEnabled&&this.$set("enabled",!0),this.$on("message_new",this.onNotification)},methods:{onNotification:function(e,t){this.playingSound||this.enabled&&!t.noNotification&&e.from!=this.ignoreFor&&(this.pingSound.play(),this.playingSound=!0,n.setTimeout(this.markPlayed,1e3))},markPlayed:function(){this.playingSound=!1}}}))}(Vue,window,window.document),function(e,n,t){var o={};new e({el:"#root",data:{nick:"",currentGroup:{name:"",messages:[]},isConnected:!1,isConnecting:!1,isReady:!1,showAppBar:!1},ready:function(){this.$el.offsetWidth>600&&this.$set("showAppBar",!0),this.transport=core.GetTransport("chat"),this.transport.events.on("connected",this.onConnected),this.transport.events.on("disconnected",this.onDisconnected),this.transport.events.on("handshake",this.onHandshaked),this.transport.events.on("raw-message",this.onRawMessage),this.transport.events.on("message",this.onMessage),this.transport.events.on("joined",this.onJoin),this.transport.events.on("leave",this.onLeave),this.transport.events.on("switch",this.onSwitch),this.transport.events.on("history",this.onHistoryRecv),this.transport.events.on("nick-changed",this.changeNick),this.transport.events.on("members-list",this.onMembersList),this.$on("switch",this.onSwitch),this.$on("leave",function(e){this.transport.send(e,"/leave "+e)}),this.$on("hamburger-clicked",function(e){this.$set("showAppBar",!this.showAppBar)}),this.$watch("currentGroup.name",function(e,n){this.$broadcast("group_switched",e)})},methods:{onSignedIn:function(e){this.$set("nick",e),this.connect()},connect:function(){this.$set("isConnecting",!0),this.$set("isConnected",!0),this.transport.connect(this.nick)},sendMessage:function(e){return"/"!=e[0]||this.transport.isValidCmd(e)&&!e.toLowerCase().startsWith("/help")?void this.transport.send(this.currentGroup.name,e):void this._appendMetaMessage(this.currentGroup.name,core.Transport.HelpMessage)},onRawMessage:function(e,n){if("Negotiate"==n.type){this._appendMetaMessage(this.currentGroup.name,"DCC to "+e);var t=new core.PeerConnectionNegotiator(this.transport);t.events.on("close",function(){t.close()}),t.connectTo(e)}},switchGroup:function(e){this.onSwitch(e)},onMembersList:function(e,n){this._appendMessage({to:e,from:this.defaultGroup,msg:"Channel members for **"+e+"**\n\n - "+n.join("\n - "),delivery_time:new Date})},onHandshaked:function(e){this.defaultGroup=e,this.transport.send(this.defaultGroup,"/join lounge")},onMessage:function(e){this._appendMessage(e)},onConnected:function(){this.$set("isConnected",!0),this.$broadcast("connection_on")},changeNick:function(e){this.$set("nick",e)},onDisconnected:function(){this.$set("isConnecting",!0),this.$broadcast("connection_off")},onJoin:function(e){this._getOrCreateGroupLog(e.to),this._appendMetaMessage(e.to,e.from+" has joined"),this.currentGroup.name==this.defaultGroup&&this.switchGroup(e.to),this.isConnecting&&this.$set("isConnecting",!1)},onLeave:function(e){e.from==this.nick?(delete o[e.to],this.$broadcast("group_left",e.to)):this._appendMetaMessage(e.to,e.from+" has left"),this.currentGroup.name==e.to&&this.nick==e.from&&this.switchGroup(this.defaultGroup)},onSwitch:function(e){return this.$el.offsetWidth<600&&this.$set("showAppBar",!1),this._getGroupLog(e)?this.currentGroup.name==e||(this.$broadcast("group-switching",e),this.$set("currentGroup.name",e),this.$set("currentGroup.messages",o[e]),this.$broadcast("group-switched",e),!1):(alert("You have not joined group "+e),!0)},onHistoryRecv:function(e){var n=e.messages;this._clearGroupLogs();for(var t in n){var o=n[t];if(o.meta)switch(o.meta.action){case"joined":this.onJoin(o)}else this._appendMessage(o,!0)}this.$broadcast("history-added",e.id)},_appendMessage:function(e,n){var t=this._getOrCreateGroupLog(e.to);if(this.currentGroup.name||(this.$set("currentGroup.name",e.to),this.$set("currentGroup.messages",t)),t.length&&t[t.length-1].from==e.from){var o=t[t.length-1];o.msg+="\n\n"+e.msg}else t.push(e);this._limitGroupHistory(e.to),n||this.$broadcast("message_new",e,{noNotification:e.to==this.defaultGroup})},_appendMetaMessage:function(e,n){var t=this._getOrCreateGroupLog(e);this.currentGroup.name||(this.$set("currentGroup.name",e),this.$set("currentGroup.messages",t)),t.push({isMeta:!0,msg:n}),this._limitGroupHistory(e)},_limitGroupHistory:function(e,n){n=n||100;var t=this._getOrCreateGroupLog(e);t.length>n&&t.splice(0,t.length-n)},_getOrCreateGroupLog:function(e){return o[e]||(o[e]=[],this.$broadcast("group_joined",e)),o[e]},_clearGroupLogs:function(e){var n=this._getGroupLog(e);n&&n.splice(0,n.length)},_getGroupLog:function(e){return o[e]||null}}})}(Vue,window,window.document);